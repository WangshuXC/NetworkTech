# 网络技术课程实验报告

<center>实验六</center>

![image-20231125193951906](./assets/image-20231125193951906.png)

<center>实验名称：NAT的配置</center>

<center>梁晓储 2110951</center>

<center>专业：物联网工程</center>

<center>提交日期：2023.12.6</center>



## 一、实验要求

- 仿真环境下的NAT服务器配置

在仿真环境下完成NAT服务器的配置实验，要求如下：

1. 学习路由器的NAT配置过程。
2. 组建由NAT连接的内网和外网。
3. 测试网络的连通性，观察网络地址映射表。
4. 在仿真环境的“模拟”方式中观察IP数据报在互联网中的传递过程，并对IP数据报的地址进行分析。



- 在仿真环境下完成如下实验

将内部网络中放置一台Web服务器，请设置NAT服务器，使外部主机能够顺利使用该Web服务。



## 二、仿真环境下的互联网组网与路由器配置

### 实验基础配置与拓扑图

实验由七台设备`PC0、PC1、PC2、Server0、Server1、S0、S1、R0`组成，其中`PC0、PC1`为内网主机，`PC2`为外网主机，`R0`为路由器，`Server1`为内网服务器，`Server0`为外网服务器，`S0、S1`为集线器。拓扑结构如下：

![image-20231206141225909](assets/image-20231206141225909.png)

配置各设备端口IP地址及路由如下：

 - 主机`PC0`

   IP：10.0.0.3/8 默认网关：10.0.0.1/8

 - 主机`PC1`

   IP：10.0.0.2/8 默认网关：10.0.0.1/8

 - 路由器`R0`

   IP1：10.0.0.1/8 IP2：202.113.25.1/24

 - 主机`PC2`

   IP：202.113.25.101/24 默认网关：202.113.25.1/24

 - 服务器`Server1`

   内网IP：10.0.0.4/8 映射IP：202.113.25.102/24

 - 服务器`Server0`

   IP：202.113.25.100/24



### 对路由器`R0`详情配置

- 建立全局使用的NAT地址池，在全局配置模式下进行：

  ```shell
  ip nat pool mynatpool 202.113.25.1 202.113.25.10 netmask 255.255.255.0
  ```

  创建了一个名为`mynatpool`，地址范围为`202.113.25.1-202.113.25.10`。

  

- 建立标准控制列表指定内部网络使用的IP地址，在全局配置模式下进行：

  ```shell
  access-list 6 permit 10.0.0.0 0.255.255.255
  ```

  创建了序号为`6`的访问控制列表，允许`10`开始的地址进行NAT转换，注意此处的通配符与掩码相反，能够改变的位为1，不能改变的位为0。

  

- 建立地址池与访问控制列表的关联，在全局配置模式下进行：

  ```sh
  nat inside source list 6 pool mynatpool overload
  ```

  将序号为`6`的访问控制列表与名为`mynatpool`的地址池关联，`overload`表示使用的端口转换方法是`NAPT`。

  

- 进入接口配置模式，指定路由器内外端口：

  ```sh
  Router(config)#interface gig0/0
  Router(config-if)#ip nat inside
  Router(config-if)#exit
  Router(config)#interface gig0/1
  Router(config-if)#ip nat outside
  Router(config-if)#exit
  ```

  指定路由器`0`号端口为连接内部网络的端口，`1`号端口为连接外部网络的端口。

  

- 配置静态NAT，将内部服务器地址映射为外部可访问的公共地址：

  ```sh
  ip nat inside source static 10.0.0.4 202.113.25.102
  ```



## 三、实验结果

- 仿真环境下，主机`PC0`对主机`PC2`发送`ping`命令：

![image-20231206142045057](assets/image-20231206142045057.png)



- 仿真环境下，主机`PC0`对主机`Server0`进行访问：

![image-20231206142156616](assets/image-20231206142156616.png)



通过模拟模式可视化地看到数据包传递过程：

![image-20231206142328876](assets/image-20231206142328876.png)

点击浏览页面的过程就是发送`TCP`报文的过程，可以在`R0`中特权模式下查看`NAT`对`TCP`报文的转发情况的统计信息：

使用`show ip nat statistics`得到结果

![image-20231206142413718](assets/image-20231206142413718.png)



使用`show ip nat translations `得到结果

![image-20231206142530363](assets/image-20231206142530363.png)



- 仿真环境下，主机`PC2`对主机`Server1`发送ping命令

  ![image-20231206143231025](assets/image-20231206143231025.png)

- 仿真环境下，主机`PC2`对主机`Server1`进行访问：

  ![image-20231206142636999](assets/image-20231206142636999.png)

  通过模拟模式可视化看到数据包转发过程：

![image-20231206142719579](assets/image-20231206142719579.png)

​	访问后，再次进入`R0`查看地址转发情况

​	![image-20231206142812837](assets/image-20231206142812837.png)

由结果可知，路由能够通过静态转换，将`202.113.25.102`固定映射为`10.0.0.4`
